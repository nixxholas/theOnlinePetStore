<div class="row">
    <div class="col-md-offset-2  col-md-8">
        <div class="panel panel-primary">
            <div class="panel-heading clearfix">
                <div class="panel-title">
                    Manage Brands
                    <div class="btn-group pull-right">
                        <a asp-action="Create" asp-controller="Brands" class="btn btn-default btn-group-lg ">Create new brand</a>
                        <a href="#" class="btn btn-danger  btn-group-lg ">Delete</a>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Brand Id</th>
                                    <th>Brand Name</th>
                                    <th>Categories</th>
                                    <th>No. of Products</th>
                                    <th>Created At</th>
                                    <th>Updated At</th>
                                    <th>&nbsp;</th>
                                </tr>
                            </thead>
                            <tbody id="brandsTableBody"></tbody>
                        </table>

                    </div>
                </div>
            </div> <!-- end of div element with class="panel-body" -->
        </div><!-- end of div element with class="panel" -->
    </div> <!-- end of div element with  class="col-md-offset-2  col-md-8"-->
</div><!-- end of div element with class="row"-->


<script>
    var brandCategories;

    loadBrandsData();
    loadBrandCategoryData();

    function loadBrandCategoryData() {
        //Note: jQuery.ajax(..) is also often written is $.ajax(..)
        var $loadBrandsDataHandler = jQuery.ajax({
            contentType: 'application/json',
            method: 'get',
            url: 'http://localhost:4992/API/BrandCategory',
        })
        $loadBrandsDataHandler.done(function (data, textStatus, jqXHR) {
            //// Like the previous cshtml, let's define a variable for
            //// the courseIdInput box
            //var $visibilityRadioListElement = $('#visibilityRadioList');
            //// We then initialize the element container
            //// for each element
            var parentElement = $("#brandsTableBody");
            var $categoryElement = null;
            var brandId = '';

            brandCategories = data;
        }//end of JavaScript anonymous function

          )//end of the done() method;
        $loadBrandsDataHandler.fail(function (data, textStatus, jqXHR) {
            noty({
                text: 'Ajax fail fired : ' + data.responseJSON.Message, type: 'error',
                layout: 'center',
                template: '<div class="noty_message"><span class="noty_text"></span>'
            });//end of noty()
        })//end of $loadCompanyDataHandler.fail()
    }//end of loadCompanyData();

    function loadBrandsData() {
        //Note: jQuery.ajax(..) is also often written is $.ajax(..)
        $loadBrandsDataHandler = jQuery.ajax({
            url: '/Api/Brands',
            method: 'GET',
            dataType: 'json',
            cache: false,
        })
        $loadBrandsDataHandler.done(function (data, textStatus, jqXHR) {
            //This done method will
            //The (data) input parameter automatically captures the response from the
            //Get() api method

            //After inspecting the data object with the console.log
            //I have clear picture of the structure and used
            //the following variable to represent the response.d
            var brandsList = data;
            var brandCategory;
            var categories = '';
            var brandId = '';
            var brandName = '';
            var noofProducts = '';
            var createdAt = "";
            var updatedAt = "";
            var $tableElement = null;
            var $cellElement = null;
            var $rowElement = null;
            //-------- Find the table element -----------
            //I am using the $tableElement variable
            //to represent the found HTML element which has a matching id of companyTableBody
            $tableBodyElement = $('#brandsTableBody');

            //I want to build rows and cells (using tr and td HTML elements) so that
            //I can display company name, address, postal code, created at, updated at information
            //within the HTML table element, companyTableBody. Recall that, I have already asked the
            //$tableBodyElement variable to represent (reference) the table element.

            //-------- Begin creating <tr> and <td> HTML element ------
            for (index = 0; index < brandsList.length; index++) {
                //Set this company variable to reference a company object
                //inside the companyList Array.
                brand = brandsList[index];
                //Copy out the company information
                brandId = brand.BrandId;
                brandName = brand.BrandName;
                noofProducts = brand.NoOfProducts;
                createdAt = new Date(brand.CreatedAt).toDateString();
                updatedAt = new Date(brand.UpdatedAt).toDateString();
                
                // For each Brand Category in the Brand Category Table
                for (i = 0; i < brandCategories.length; i++) {
                    // If the Brand Id is equivalent to the one we have
                    if (brandCategories[i].BrandId == brandId) {
                        // Add it into the column categories
                        categories += brandCategories[i].CatName;
                        categories += ", ";
                    }
                }

                // The loop causes the last two characters to be ", ". Let's remove it.
                categories = categories.substring(0, categories.length - 2)

                //Create new HTML <tr> element.
                //At the same time let the $rowElement variable to represent it.
                $rowElement = $('<tr id="row' + brandId + '"></tr>');
                //Create the 1st cell element which display Brand Id
                $cellElement = $('<td id="brandIdis' + brandId + '">' + brandId + '</td>');
                $rowElement.append($cellElement);
                //Create the 2nd cell element which display address
                $cellElement = $('<td></td>', { text: brandName });
                $rowElement.append($cellElement);
                //Create the 3rd cell element which display postal code
                $cellElement = $('<td></td>', { text: categories });
                $rowElement.append($cellElement);
                //Create the 3rd cell element which display postal code
                $cellElement = $('<td></td>', { text: noofProducts });
                $rowElement.append($cellElement);
                //Create the 4th cell element which display created at information
                $cellElement = $('<td></td>', { text: createdAt });
                $rowElement.append($cellElement);
                //Create the 5th cell element which display updated at information
                $cellElement = $('<td></td>', { text: updatedAt });
                $rowElement.append($cellElement);
                //---------------- Using jQuery() to create the hyperlink element using the <a></a> --------
                $hyperLinkElement = $('<a>Edit Brand</a>').attr('href', '/Brands/Update/' + brandId);
                $hyperLinkElement.addClass('btn btn-primary');
                //The $hyperLinkElement eventually represents (references) a HTML element which is:
                //<a href="/Companies/Update/<company id>" class="btn btn-primary" >Edit Company</a>
                //-----------------Using jQuery() to creating the 6th cell for the row----------------------
                $cellElement = $('<td></td>');
                //-----------------Add the previous created hyperlink element, $hyperLinkElement
                //                 into the newly created 6th cell.
                //As a result, $cellElement references an element defined by:
                //<td><a href="/Companies/Update/<company id>" class="btn btn-primary" >Edit Company</a></td>
                $cellElement.append($hyperLinkElement);

                //---------------Add the 6th cell into the row represented by the $rowElement
                $rowElement.append($cellElement);
                //Insert the $rowElement into the table element represented by $tableElement.
                $tableBodyElement.append($rowElement);
                //----End of creating one row to display one company by using <tr> and <td> HTML element ---
                //       Proceed to the next company object in the companyList Array.
                categories = '';
            }//end of for loop.
        }//end of JavaScript anonymous function

         )//end of the done() method;
        $loadBrandsDataHandler.fail(function (data, textStatus, jqXHR) {
            noty({
                text: 'Ajax fail fired : ' + data.responseJSON.Message, type: 'error',
                layout: 'center',
                template: '<div class="noty_message"><span class="noty_text"></span>'
            });//end of noty()
        })//end of $loadCompanyDataHandler.fail()


    }//end of loadCompanyData();

</script>

